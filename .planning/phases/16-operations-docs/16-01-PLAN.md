---
phase: 16-operations-docs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mix.exs
  - docs/architecture.md
autonomous: true
must_haves:
  truths:
    - "Running `mix docs` generates HTML documentation including the architecture guide in the sidebar"
    - "The architecture guide contains Mermaid diagrams for supervision tree, task lifecycle, and sidecar-hub communication"
    - "The architecture guide explains design rationale for key decisions (DETS over Postgres, GenServer per table, single BEAM node)"
    - "Module docs are organized into logical groups (Core, Task Pipeline, Communication, etc.) in the generated docs"
  artifacts:
    - path: "mix.exs"
      provides: "ExDoc dependency and docs configuration"
      contains: "ex_doc"
    - path: "docs/architecture.md"
      provides: "System architecture overview with diagrams and rationale"
      contains: "mermaid"
  key_links:
    - from: "mix.exs"
      to: "docs/architecture.md"
      via: "extras configuration in docs/0"
      pattern: "docs/architecture.md"
    - from: "docs/architecture.md"
      to: "AgentCom module docs"
      via: "backtick cross-references"
      pattern: "AgentCom\\."
---

<objective>
Configure ExDoc for the project and create the architecture overview document with Mermaid diagrams, component descriptions, and design rationale.

Purpose: Establishes the documentation infrastructure (ExDoc) and the foundational architecture reference that all other operations guides cross-reference. Operators need to understand the system's structure before they can set it up, operate it, or troubleshoot it.

Output: ExDoc-configured mix.exs, docs/architecture.md with Mermaid diagrams
</objective>

<execution_context>
@C:/Users/nrosq/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/nrosq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-operations-docs/16-RESEARCH.md
@mix.exs
@lib/agent_com/application.ex
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure ExDoc in mix.exs</name>
  <files>mix.exs</files>
  <action>
Add ex_doc dependency and docs configuration to mix.exs:

1. Add to deps: `{:ex_doc, "~> 0.35", only: :dev, runtime: false}`

2. Add `docs: docs()` to the project/0 keyword list (after `aliases: aliases()`)

3. Create the `docs/0` private function with:
   - `main: "architecture"` (architecture overview as landing page)
   - `extras:` list referencing all 4 guide files:
     - `"docs/architecture.md"`
     - `"docs/setup.md"`
     - `"docs/daily-operations.md"`
     - `"docs/troubleshooting.md"`
   - `groups_for_extras:` with an "Operations Guide" group containing all 4 files
   - `groups_for_modules:` organizing all 31 modules into logical groups per the RESEARCH.md pattern:
     - "Core": Application, Config, Auth
     - "Task Pipeline": TaskQueue, Scheduler, AgentFSM, AgentSupervisor
     - "Communication": Socket, Mailbox, Channels, Router, Presence, Message, MessageHistory, Threads
     - "Monitoring & Alerting": MetricsCollector, Alerter, Analytics, Telemetry
     - "Dashboard": Dashboard, DashboardState, DashboardSocket, DashboardNotifier
     - "Storage & Backup": DetsBackup
     - "Validation": Validation, Validation.Schemas, Validation.ViolationTracker
     - "Infrastructure": Reaper, Endpoint

4. Run `mix deps.get` to fetch ex_doc

5. Verify with `mix docs` -- it should generate docs even if the extras files don't exist yet (ExDoc warns but doesn't fail on missing extras). If it does fail, create placeholder files for setup.md, daily-operations.md, troubleshooting.md with just a title.
  </action>
  <verify>
Run `mix deps.get` succeeds. Run `mix docs` completes without errors. Check that `doc/index.html` is generated.
  </verify>
  <done>mix.exs has ex_doc dependency and full docs configuration. `mix docs` generates HTML output.</done>
</task>

<task type="auto">
  <name>Task 2: Create architecture overview with Mermaid diagrams</name>
  <files>docs/architecture.md</files>
  <action>
Create `docs/architecture.md` -- the system architecture overview. This is the ExDoc landing page and the foundational reference for all other guides.

**Writing style per locked decisions:** Narrative walkthrough with WHY explanations. Solo operator audience who built the system -- skip generic Elixir/OTP basics, focus on AgentCom-specific architecture decisions and their reasoning.

**Structure the document as follows:**

## 1. System Overview
Brief description of what AgentCom is: an Elixir/OTP hub that coordinates autonomous agents via WebSocket-connected Node.js sidecars. Tasks flow in via API, get scheduled to idle agents, executed by sidecars, and results flow back. A real-time dashboard provides visibility.

## 2. Supervision Tree
Include the Mermaid diagram from RESEARCH.md showing all 20+ supervised children. Add narrative explaining:
- Why :one_for_one strategy (independent services, crash isolation)
- Why ordering matters (PubSub first, Bandit last -- dependencies flow downward)
- Cross-reference `AgentCom.Application` for the actual child spec list

## 3. Task Lifecycle
Include the sequence diagram from RESEARCH.md. Add narrative explaining:
- The submit -> schedule -> assign -> accept -> complete pipeline
- Why the Scheduler is event-driven (PubSub) not polling
- How retries and dead-lettering work
- Cross-reference `AgentCom.TaskQueue` and `AgentCom.Scheduler`

## 4. Agent Communication
Include the sidecar-hub communication diagram from RESEARCH.md. Add narrative explaining:
- Why Node.js sidecar (agent processes are external CLI tools, need a persistent WebSocket relay)
- How authentication works (token-based, registered via /api/onboard/register)
- Heartbeat/presence mechanism and Reaper eviction
- Cross-reference `AgentCom.Socket`, `AgentCom.Presence`, `AgentCom.Reaper`

## 5. Data Storage
Explain the DETS-based persistence strategy:
- Why DETS over Postgres (single-node system, no external deps, built into OTP, sufficient for 5-agent scale)
- Why GenServer-per-table (ownership model, crash isolation, serialized writes)
- List all 9 DETS tables with their owner GenServer and purpose (table from RESEARCH.md)
- Backup, compaction, and corruption recovery overview
- Cross-reference `AgentCom.DetsBackup`

## 6. Observability Stack
Explain the three layers:
- Structured logging (LoggerJSON, JSON format, file rotation) -- cross-ref Phase 13
- Telemetry events (attach handlers in Telemetry module) -- cross-ref `AgentCom.Telemetry`
- Metrics aggregation (MetricsCollector, ETS-backed, 10s snapshots) -- cross-ref `AgentCom.MetricsCollector`
- Alerting (Alerter, 5 rules, cooldowns, dashboard + push notifications) -- cross-ref `AgentCom.Alerter`

## 7. Design Rationale Summary
A consolidated table of key "why" decisions:
| Decision | Rationale |
| DETS over Postgres | No external deps, built into OTP, sufficient at 5-agent scale |
| GenServer per table | Crash isolation, serialized DETS writes, clear ownership |
| Single BEAM node | No distribution complexity, Tailscale for remote access |
| Node.js sidecar | Agents are external CLI processes, need persistent WS relay |
| Token auth (not OAuth) | Internal system, agents are trusted, tokens via API |
| ETS for metrics | High-frequency writes from telemetry handlers, zero-cost reads |
| PubSub for events | Decoupled components, no direct GenServer dependencies |

Use backtick cross-references throughout (e.g., `AgentCom.TaskQueue`) so ExDoc creates clickable links.
  </action>
  <verify>
Run `mix docs` and open `doc/index.html`. Verify:
1. Architecture page loads as the main page
2. Mermaid diagrams render (3 diagrams visible)
3. Module cross-references are clickable links
4. "Operations Guide" group appears in sidebar with architecture.md listed
5. Module groups appear correctly in sidebar
  </verify>
  <done>docs/architecture.md exists with supervision tree diagram, task lifecycle diagram, sidecar-hub diagram, design rationale table, and cross-references to module docs. ExDoc renders it as the landing page.</done>
</task>

</tasks>

<verification>
1. `mix deps.get` succeeds (ex_doc fetched)
2. `mix docs` completes without errors
3. `doc/index.html` exists and loads in browser
4. Architecture page has 3 Mermaid diagrams
5. Module groups appear in sidebar
6. Cross-references resolve to module pages
</verification>

<success_criteria>
ExDoc is configured and generating HTML docs. The architecture overview document serves as the landing page with Mermaid diagrams for supervision tree, task lifecycle, and sidecar-hub communication. All module docs are organized into logical groups. Cross-references from guide prose to module pages are functional.
</success_criteria>

<output>
After completion, create `.planning/phases/16-operations-docs/16-01-SUMMARY.md`
</output>
