---
phase: 16-operations-docs
plan: 02
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - docs/setup.md
autonomous: true
must_haves:
  truths:
    - "The setup guide walks through installing Erlang, Elixir, and Node.js prerequisites from scratch"
    - "The setup guide documents starting the hub and verifying it responds on /health"
    - "The setup guide walks through full agent onboarding: register, configure sidecar, connect, verify on dashboard"
    - "The setup guide ends with a smoke test: submit task, observe scheduling, verify completion"
    - "The guide is dev-environment only with no production deployment content"
  artifacts:
    - path: "docs/setup.md"
      provides: "Complete hub setup and first-run walkthrough"
      contains: "mix run --no-halt"
  key_links:
    - from: "docs/setup.md"
      to: "docs/architecture.md"
      via: "cross-reference for system context"
      pattern: "architecture"
    - from: "docs/setup.md"
      to: "AgentCom module docs"
      via: "backtick cross-references"
      pattern: "AgentCom\\."
---

<objective>
Create the setup guide that walks an operator through installing prerequisites, starting the hub, onboarding an agent, and running a smoke test.

Purpose: Satisfies OPS-01 (hub setup, configuration, startup procedures, verification). This is the first document a returning operator reads after months away -- it must cover everything from installing Erlang to seeing a task complete.

Output: docs/setup.md
</objective>

<execution_context>
@C:/Users/nrosq/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/nrosq/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-operations-docs/16-RESEARCH.md
@.planning/phases/16-operations-docs/16-01-SUMMARY.md
@mix.exs
@config/config.exs
@sidecar/add-agent.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create setup guide</name>
  <files>docs/setup.md</files>
  <action>
Create `docs/setup.md` -- the complete setup guide from scratch to running system.

**Writing style per locked decisions:** Narrative walkthrough with WHY explanations for each step. Solo operator audience. Dev environment only. Include architecture rationale where relevant.

**Structure the document as follows:**

## 1. Prerequisites
Document installing from scratch on Windows (the actual dev environment):
- **Erlang/OTP 25+**: Why needed (DETS, :logger, :httpc are OTP modules AgentCom uses directly). Installation via Erlang installer or chocolatey.
- **Elixir ~> 1.14**: Why needed (Mix build tool, GenServer, Logger). Installation via Elixir installer or chocolatey. Verify with `elixir --version`.
- **Node.js 18+**: Why needed (sidecar uses `node:util` parseArgs, modern APIs). Installation via nodejs.org or nvm-windows. Verify with `node --version`.
- **npm**: Bundled with Node.js. Used for sidecar dependencies.
- **pm2** (global): Why needed (process management for sidecar -- keeps it running, provides log management). Install with `npm install -g pm2`.
- **Optional: jq**: For JSON log parsing during troubleshooting. Cross-reference troubleshooting guide.
- **Optional: git**: For agent git-workflow features (branch creation, PR submission).

## 2. Clone and Install
- Clone the repository
- `mix deps.get` to fetch Elixir dependencies
- `cd sidecar && npm install` for sidecar dependencies
- Explain what the key dependencies are (phoenix_pubsub, bandit, jason, logger_json, web_push_elixir)

## 3. Configuration
Walk through the configuration files:
- `config/config.exs` -- explain each setting block (port, backup_dir, logger, compaction intervals)
- Environment variables: PORT (default 4000), ADMIN_AGENTS, MIX_ENV
- Where DETS files live (priv/ for most, ~/.agentcom/data/ for config/threads)
- Where logs go (priv/logs/agent_com.log, rotation settings)
- Where backups go (priv/backups/, configurable)
- Cross-reference `AgentCom.Config` for runtime configuration

## 4. Starting the Hub
- `iex -S mix` for interactive (recommended for first run -- can inspect state)
- `mix run --no-halt` for background
- What happens at startup: supervision tree boots, DETS tables open/create, telemetry handlers attach, Bandit binds to port
- Verify with `curl http://localhost:4000/health` -- expect `{"status":"ok","agents_connected":0}`
- Open dashboard at `http://localhost:4000/dashboard` -- should show empty state

## 5. Agent Onboarding
Walk through the full onboarding flow:

**Option A: Automated (recommended)**
- `node sidecar/add-agent.js --hub http://localhost:4000 --name my-agent`
- Explain what it does: registers agent, gets token, creates config, sets up pm2, starts sidecar
- Where config lives: `~/.agentcom/<agent-name>/config.json`
- Where logs go: `~/.agentcom/<agent-name>/logs/`

**Option B: Manual**
- Register: `curl -X POST http://localhost:4000/api/onboard/register -H 'Content-Type: application/json' -d '{"agent_id":"my-agent"}'` -- returns token
- Create `sidecar/config.json` with required fields (agent_id, token, hub_url)
- Document all sidecar config fields from RESEARCH.md table
- Start: `cd sidecar && node index.js` (or via pm2)

**Verification:**
- Dashboard shows agent with "idle" state
- `GET /api/agents` lists the agent
- Hub logs show `agent_com.agent.connect` event

## 6. Smoke Test Walkthrough
End-to-end verification that the full pipeline works:

1. **Submit a task:**
   ```
   curl -X POST http://localhost:4000/api/tasks \
     -H 'Authorization: Bearer <token>' \
     -H 'Content-Type: application/json' \
     -d '{"description":"Test task","priority":"normal"}'
   ```
   Explain: task enters TaskQueue in "queued" status

2. **Observe scheduling:**
   - Dashboard should show task assigned to idle agent within 30 seconds (or immediately if Scheduler gets PubSub event)
   - `GET /api/tasks?status=assigned` returns the task
   - Hub logs show `scheduler_attempt` and `task_assigned` events

3. **Observe execution (if wake_command configured):**
   - Sidecar invokes wake_command with task details
   - Agent process runs and produces result
   - `GET /api/tasks/<id>` shows status "completed"

4. **If no wake_command:** Task stays assigned. This is expected -- the smoke test confirms scheduling works. Complete it manually via the sidecar (or just observe it was assigned correctly).

5. **Check metrics:** `GET /api/metrics` shows the task in throughput counters
6. **Check dashboard:** All widgets should reflect the activity

Cross-reference architecture.md for understanding the flow. Cross-reference daily-operations.md for ongoing monitoring.
  </action>
  <verify>
Run `mix docs` and verify:
1. Setup guide appears in sidebar under "Operations Guide"
2. Cross-references to module docs resolve
3. All code blocks render correctly
4. Sequential flow makes sense (no step references something not yet explained)
  </verify>
  <done>docs/setup.md covers prerequisites through smoke test. An operator can follow it from a fresh machine to a working hub with a connected agent and a submitted task.</done>
</task>

</tasks>

<verification>
1. `mix docs` completes without warnings about setup.md
2. Setup guide appears in ExDoc sidebar
3. All cross-references resolve
4. Steps follow a logical sequence (no forward references)
5. No production deployment content present
</verification>

<success_criteria>
The setup guide documents the complete path from installing prerequisites to a working system with a connected agent and completed smoke test. It is dev-environment focused, uses narrative style with WHY explanations, and cross-references architecture.md and module docs where relevant.
</success_criteria>

<output>
After completion, create `.planning/phases/16-operations-docs/16-02-SUMMARY.md`
</output>
